<div
  class="fixed inset-0 bg-gray-100 bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50" *ngIf="initializeAssistantModal"
>
  <div class="bg-white rounded-lg shadow-lg p-6 w-80">
    <h2 class="text-lg font-semibold mb-4 text-center">Start Meeting</h2>
    <p class="text-sm text-gray-600 mb-6 text-center">
      Are you ready to start the meeting?
    </p>
    <div class="flex justify-between">
      <button
        class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
        (click)="initializeAssistant()"
      >
        Start
      </button>
      <button
        class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600"
      >
        Cancel
      </button>
    </div>
  </div>
</div>

<div class="fixed z-40 top-0 left-0 w-full h-full bg-gray-100 flex flex-col">
  <!-- Header -->
  <div class="py-6 px-4 bg-gray-200">
    <div class="flex items-center gap-2">
      <mat-icon
        class="text-transparent bg-gradient-to-t from-green-400 to-green-200 bg-clip-text"
      >
        star_shine
      </mat-icon>
      <h3 class="text-base font-semibold">
        Exploring Your Path: An Initial Consultation
      </h3>
    </div>
  </div>
  <section class="flex-1 w-full h-full flex">
    <div class="relative mb-auto w-full p-8 flex flex-col">
      <div class="">
        <app-meet-avatar [size]="44" [isTalking]="false"></app-meet-avatar>
      </div>
      <div class="flex">
        <div
          class="mt-8 p-4 rounded bg-gray-200 mr-auto flex-1 max-h-32 overflow-y-auto"
        >
          {{ transcription }}
        </div>
        <app-meet-avatar
          [imageUrl]="
            currentUser.photoURL ||
            'https://png.pngtree.com/element_our/png/20181206/users-vector-icon-png_260862.jpg'
          "
          [isTalking]="isRecording"
        ></app-meet-avatar>
      </div>
    </div>
  </section>

  <!-- Bottom Bar -->
  <div
    class="z-10 absolute bottom-0 w-full bg-gray-100 p-6 grid grid-cols-1 md:grid-cols-3 items-center justify-items-center"
  >
    <div class="hidden md:block justify-self-start py-2">11:37PM</div>

    <!-- Buttons -->
    <div class="flex flex-col items-center space-y-3">
      <div class="flex items-center space-x-2">
        <!-- ✅ Updated Mic Toggle Button -->

        <button class="icon_btn" matTooltip="Toggle Mic" (click)="toggleMic()">
          <mat-icon>{{ isRecording ? "mic" : "mic_off" }}</mat-icon>
        </button>

        <button class="icon_btn" disabled>
          <mat-icon>videocam_off</mat-icon>
        </button>

        <button class="icon_btn">
          <mat-icon>closed_caption</mat-icon>
        </button>

        <button class="icon_btn" [matMenuTriggerFor]="meetMenu">
          <mat-icon>more_vert</mat-icon>
        </button>

        <span class="!ml-3 !mr-1 text-gray-200">|</span>

        <button mat-mini-fab class="border" color="warn">
          <mat-icon>call_end</mat-icon>
        </button>

        <!-- ✅ Pulsing Mic with Recording Animation -->
        @if (!isRecording) {
        <div class="relative inline-flex items-center justify-center">
          <!-- Pulse Animation Circle -->
          <div
            class="absolute animate-ping inline-flex h-10 w-10 rounded-full bg-red-400 opacity-75"
          ></div>
          <!-- Static Circle -->
          <div
            class="relative inline-flex rounded-full h-10 w-10 bg-red-500 items-center justify-center"
          >
            <mat-icon class="text-white text-[1.5rem]">mic</mat-icon>
          </div>
          <!-- Timer -->
          <div
            class="absolute bottom-[-2rem] text-sm text-gray-700 font-semibold"
          >
            {{ timeLeft }}s
          </div>
        </div>
        }
      </div>
    </div>

    <!-- Info & Lock -->
    <div class="hidden md:flex items-center justify-self-end p-2">
      <button class="icon_btn-2">
        <mat-icon>info</mat-icon>
      </button>
      <span class="icon_btn-2">
        <mat-icon>lock</mat-icon>
      </span>
    </div>
  </div>
  <!-- Popup Menu -->
  <mat-menu #meetMenu="matMenu" class="!bg-gray-50 !shadow-sm">
    <button mat-menu-item>Settings</button>
    <button mat-menu-item>System Health</button>
    <div class="my-2 h-[2px] bg-gray-300 overflow-hidden"></div>
    <button mat-menu-item>Help/Support</button>
    <button mat-menu-item>About</button>
  </mat-menu>
</div>

<audio #remoteAudio autoplay></audio>

